!function(e){e.fn.richText=function(t){function a(e,t){void 0===t&&(t=null),o(),"heading"===e&&l()?d("<"+t+">"+l()+"</"+t+">"):document.execCommand(e,!1,t)}function n(){var t=e("#"+q),a=t.html();!0===s.useSingleQuotes&&(a=c(a)),t.siblings(".richText-initial").val(a)}function i(){var t=e("#"+q),a=t.siblings(".richText-initial").val();t.html(a)}function l(){return window.getSelection?window.getSelection().toString():!!document.selection.createRange&&document.selection.createRange().text}function r(){g=u()}function o(){g&&h()}function d(e){var t,a;if(window.getSelection){if((t=window.getSelection()).getRangeAt&&t.rangeCount){(a=t.getRangeAt(0)).deleteContents();var n=document.createElement("div");n.innerHTML=e;for(var i,l,r=document.createDocumentFragment();i=n.firstChild;)l=r.appendChild(i);a.insertNode(r),l&&((a=a.cloneRange()).setStartAfter(l),a.collapse(!0),t.removeAllRanges(),t.addRange(a))}}else document.selection&&"Control"!==document.selection.type&&document.selection.createRange().pasteHTML(e)}function c(e){if(!e)return"";var t,a;return!0===s.useSingleQuotes?(t=/\s+(\w+\s*=\s*(["][^"]*["])|(['][^']*[']))+/g,a=e.replace(t,function(e,t,a){return a?e.replace(a,a.replace(/\"/g,"'")):e})):(t=/\s+(\w+\s*=\s*(['][^']*['])|(["][^"]*["]))+/g,a=e.replace(t,function(e,t,a){return a?e.replace(a,a.replace(/'/g,'"')):e})),a}function p(){m.find(".richText-editor").is(":visible")?(m.find(".richText-initial").show(),m.find(".richText-editor").hide(),e(".richText-toolbar").find(".richText-btn").each(function(){e(this).hasClass("fa-code")||e(this).parent("li").attr("data-disable","true")})):(m.find(".richText-initial").hide(),m.find(".richText-editor").show(),e(".richText-toolbar").find("li").removeAttr("data-disable"))}var s=e.extend({bold:!0,italic:!0,underline:!0,leftAlign:!0,centerAlign:!0,rightAlign:!0,ol:!0,ul:!0,heading:!0,fontColor:!0,imageUpload:!0,fileUpload:!0,urls:!0,table:!0,removeStyles:!0,code:!0,colors:[],fileHTML:"",imageHTML:"",useSingleQuotes:!1},t),f=e(this);f.addClass("richText-initial");var m,u,h,g,x=e("<ul />"),v=e("<li />"),T=e("<a />",{class:"richText-btn fa fa-bold","data-command":"bold"}),b=e("<a />",{class:"richText-btn fa fa-italic","data-command":"italic"}),R=e("<a />",{class:"richText-btn fa fa-underline","data-command":"underline"}),w=e("<a />",{class:"richText-btn fa fa-align-left","data-command":"justifyLeft"}),y=e("<a />",{class:"richText-btn fa fa-align-center","data-command":"justifyCenter"}),C=e("<a />",{class:"richText-btn fa fa-align-right","data-command":"justifyRight"}),L=e("<a />",{class:"richText-btn fa fa-list-ol","data-command":"insertOrderedList"}),k=e("<a />",{class:"richText-btn fa fa-list","data-command":"insertUnorderedList"}),S=e("<a />",{class:"richText-btn fa fa-header"}),U=e("<a />",{class:"richText-btn fa fa-paint-brush"}),F=e("<a />",{class:"richText-btn fa fa-image"}),A=e("<a />",{class:"richText-btn fa fa-file-text-o"}),B=e("<a />",{class:"richText-btn fa fa-link"}),D=e("<a />",{class:"richText-btn fa fa-table"}),E=e("<a />",{class:"richText-btn fa fa-recycle","data-command":"removeFormat"}),M=e("<a />",{class:"richText-btn fa fa-code","data-command":"toggleCode"}),H=e("<div />",{class:"richText-dropdown-outer"}),I=e("<ul />",{class:"richText-dropdown"}),Q=e("<div />",{class:"richText-dropdown"}),N=e("<div />",{class:"richText-form"}),P=e("<div />",{class:"richText-form-item"}),W=e("<label />"),_=e("<input />",{type:"text"}),j=(e("<input />",{type:"file"}),e("<select />")),O=e("<button />",{text:"Einf√ºgen",class:"btn"}),q="richText-"+Math.random().toString(36).substring(7),G=I.clone();G.append(e("<li />",{html:'<a data-command="formatBlock" data-option="h1">Title #1</a>'})),G.append(e("<li />",{html:'<a data-command="formatBlock" data-option="h2">Title #2</a>'})),G.append(e("<li />",{html:'<a data-command="formatBlock" data-option="h3">Title #3</a>'})),G.append(e("<li />",{html:'<a data-command="formatBlock" data-option="h4">Title #4</a>'})),S.append(H.clone().append(G));var X=I.clone();X.html(function(e){var t=[],a="";t["#FFFFFF"]="White",t["#000000"]="Black",t["#7F6000"]="Brown",t["#938953"]="Beige",t["#1F497D"]="Dark Blue",t.blue="Blue",t["#4F81BD"]="Light blue",t["#953734"]="Dark red",t.red="Red",t["#4F6128"]="Dark green",t.green="Green",t["#3F3151"]="Purple",t["#31859B"]="Dark Turquois",t["#4BACC6"]="Turquois",t["#E36C09"]="Dark orange",t["#F79646"]="Orange",t["#FFFF00"]="Yellow",s.colors&&s.colors.length>0&&(t=s.colors);for(var n in t)a+='<li class="inline"><a data-command="'+e+'" data-option="'+n+'" style="text-align:left;" title="'+t[n]+'"><span class="box-color" style="background-color:'+n+'"></span></a></li>';return a}("forecolor")),U.append(H.clone().append(X));var Y=Q.clone(),$=N.clone().attr("id","richText-URL").attr("data-editor",q);$.append(P.clone().append(W.clone().text("URL").attr("for","url")).append(_.clone().attr("id","url"))),$.append(P.clone().append(W.clone().text("Text").attr("for","urlText")).append(_.clone().attr("id","urlText"))),$.append(P.clone().append(W.clone().text("Open in").attr("for","openIn")).append(j.clone().attr("id","openIn").append(e("<option />",{value:"_self",text:"Same tab"})).append(e("<option />",{value:"_blank",text:"New tab"})))),$.append(P.clone().append(O.clone())),Y.append($),B.append(H.clone().append(Y));var z=Q.clone(),J=N.clone().attr("id","richText-Image").attr("data-editor",q);s.imageHTML&&(e(s.imageHTML).find("#imageURL").length>0||"imageURL"===e(s.imageHTML).attr("id"))?J.html(s.imageHTML):(J.append(P.clone().append(W.clone().text("Image URL").attr("for","imageURL")).append(_.clone().attr("id","imageURL"))),J.append(P.clone().append(W.clone().text("Align").attr("for","align")).append(j.clone().attr("id","align").append(e("<option />",{value:"left",text:"Left"})).append(e("<option />",{value:"center",text:"Center"})).append(e("<option />",{value:"right",text:"Right"}))))),J.append(P.clone().append(O.clone())),z.append(J),F.append(H.clone().append(z));var K=Q.clone(),V=N.clone().attr("id","richText-File").attr("data-editor",q);s.fileHTML&&(e(s.fileHTML).find("#fileURL").length>0||"fileURL"===e(s.fileHTML).attr("id"))?V.html(s.fileHTML):(V.append(P.clone().append(W.clone().text("File URL").attr("for","fileURL")).append(_.clone().attr("id","fileURL"))),V.append(P.clone().append(W.clone().text("Link text").attr("for","fileText")).append(_.clone().attr("id","fileText")))),V.append(P.clone().append(O.clone())),K.append(V),A.append(H.clone().append(K));var Z=Q.clone(),ee=N.clone().attr("id","richText-Table").attr("data-editor",q);ee.append(P.clone().append(W.clone().text("Rows").attr("for","tableRows")).append(_.clone().attr("id","tableRows").attr("type","number"))),ee.append(P.clone().append(W.clone().text("Columns").attr("for","tableColumns")).append(_.clone().attr("id","tableColumns").attr("type","number"))),ee.append(P.clone().append(O.clone())),Z.append(ee),D.append(H.clone().append(Z));return function(){var t,a,n="";"TEXTAREA"===f.prop("tagName")||(f.val()?(t=f.val(),a=f.prop("attributes"),e.each(a,function(){this.name&&(n+=" "+this.name+'="'+this.value+'"')}),f.replaceWith(e("<textarea"+n+' data-richtext="init">'+t+"</textarea>")),(f=e('[data-richtext="init"]')).removeAttr("data-richtext")):f.html()?(t=f.html(),a=f.prop("attributes"),e.each(a,function(){this.name&&(n+=" "+this.name+'="'+this.value+'"')}),f.replaceWith(e("<textarea"+n+' data-richtext="init">'+t+"</textarea>")),(f=e('[data-richtext="init"]')).removeAttr("data-richtext")):(a=f.prop("attributes"),e.each(a,function(){this.name&&(n+=" "+this.name+'="'+this.value+'"')}),f.replaceWith(e("<textarea"+n+' data-richtext="init"></textarea>')),(f=e('[data-richtext="init"]')).removeAttr("data-richtext"))),m=e("<div />",{class:"richText"});var i=e("<div />",{class:"richText-toolbar"}),l=e("<div />",{class:"richText-editor",id:q,contenteditable:!0});i.append(x),!0===s.bold&&x.append(v.clone().append(T)),!0===s.italic&&x.append(v.clone().append(b)),!0===s.underline&&x.append(v.clone().append(R)),!0===s.leftAlign&&x.append(v.clone().append(w)),!0===s.centerAlign&&x.append(v.clone().append(y)),!0===s.rightAlign&&x.append(v.clone().append(C)),!0===s.ol&&x.append(v.clone().append(L)),!0===s.ul&&x.append(v.clone().append(k)),!0===s.heading&&x.append(v.clone().append(S)),!0===s.fontColor&&x.append(v.clone().append(U)),!0===s.imageUpload&&x.append(v.clone().append(F)),!0===s.fileUpload&&x.append(v.clone().append(A)),!0===s.urls&&x.append(v.clone().append(B)),!0===s.table&&x.append(v.clone().append(D)),!0===s.removeStyles&&x.append(v.clone().append(E)),!0===s.code&&x.append(v.clone().append(M)),l.html(f.val()),m.append(i),m.append(l),m.append(f.clone().hide()),f.replaceWith(m)}(),e(document).on("keyup keydown blur paste copy cut",".richText-editor",function(){n(),r()}),e(document).on("keyup keydown blur paste copy cut",".richText-initial",function(){i(),r()}),e(document).on("dblclick mouseup",".richText-editor",function(){r()}),e(document).on("click","#richText-URL button.btn",function(t){t.preventDefault();var a=e(this).parent(".richText-form-item").parent(".richText-form");if(a.attr("data-editor")===q){var n=a.find("input#url").val(),i=a.find("input#urlText").val(),l=a.find("#openIn").val();if(l||(l="_self"),i||(i=n),n){var r="";r=!0===s.useSingleQuotes?"<a href='"+n+"' target='"+l+"'>"+i+"</a>":'<a href="'+n+'" target="'+l+'">'+i+"</a>",h(),d(r),a.find("input#url").val(""),a.find("input#urlText").val(""),e(".richText-toolbar li.is-selected").removeClass("is-selected")}else a.prepend(e("<div />",{style:"color:red;display:none;",class:"form-item is-error",text:"Please enter an URL"})),a.children(".form-item.is-error").slideDown(),setTimeout(function(){a.children(".form-item.is-error").slideUp(function(){e(this).remove()})},5e3)}}),e(document).on("click","#richText-Image button.btn",function(t){t.preventDefault();var a=e(this).parent(".richText-form-item").parent(".richText-form");if(a.attr("data-editor")===q){var n=a.find("#imageURL").val(),i=a.find("select#align").val();if(i||(i="center"),n){var l="";!0===s.useSingleQuotes?(console.log("image"),l="center"===i?"<div style='text-align:center;'><img src='"+n+"'></div>":"<img src='"+n+"' align='"+i+"'>"):l="center"===i?'<div style="text-align:center;"><img src="'+n+'"></div>':'<img src="'+n+'" align="'+i+'">',h(),d(l),a.find("input#imageURL").val(""),e(".richText-toolbar li.is-selected").removeClass("is-selected")}else a.prepend(e("<div />",{style:"color:red;display:none;",class:"form-item is-error",text:"Please select an image."})),a.children(".form-item.is-error").slideDown(),setTimeout(function(){a.children(".form-item.is-error").slideUp(function(){e(this).remove()})},5e3)}}),e(document).on("click","#richText-File button.btn",function(t){t.preventDefault();var a=e(this).parent(".richText-form-item").parent(".richText-form");if(a.attr("data-editor")===q){var n=a.find("#fileURL").val(),i=a.find("#fileText").val();if(i||(i=n),n){var l="";l=!0===s.useSingleQuotes?"<a href='"+n+"' target='_blank'>"+i+"</a>":'<a href="'+n+'" target="_blank">'+i+"</a>",h(),d(l),a.find("input#fileURL").val(""),a.find("input#fileText").val(""),e(".richText-toolbar li.is-selected").removeClass("is-selected")}else a.prepend(e("<div />",{style:"color:red;display:none;",class:"form-item is-error",text:"Please select a file."})),a.children(".form-item.is-error").slideDown(),setTimeout(function(){a.children(".form-item.is-error").slideUp(function(){e(this).remove()})},5e3)}}),e(document).on("click","#richText-Table button.btn",function(t){t.preventDefault();var a=e(this).parent(".richText-form-item").parent(".richText-form");if(a.attr("data-editor")===q){var n=a.find("input#tableRows").val(),i=a.find("input#tableColumns").val();(!n||n<=0)&&(n=2),(!i||i<=0)&&(i=2);var l="";l=!0===s.useSingleQuotes?"<table class='table-1'><tbody>":'<table class="table-1"><tbody>';for(var r=1;r<=n;r++){l+="<tr>";for(var o=1;o<=i;o++)l+="<td> </td>";l+="</tr>"}l+="</tbod></table>",h(),d(l),a.find("input#tableColumns").val(""),a.find("input#tableRows").val(""),e(".richText-toolbar li.is-selected").removeClass("is-selected")}}),e(document).on("click",function(t){var a=e(t.target);if(0===a.parents(".richText-toolbar").length);else if(a.hasClass("richText-dropdown-outer"))a.parent("a").parent("li").removeClass("is-selected");else if(a.find(".richText").length>0)e(".richText-toolbar li").removeClass("is-selected");else if(a.hasClass("richText-btn")&&e(t.target).children(".richText-dropdown-outer").length>0)if(a.parent("li").addClass("is-selected"),a.hasClass("fa-link")){h();var n=l();a.find("input#urlText").val(""),a.find("input#url").val(""),n&&a.find("input#urlText").val(n)}else a.hasClass("fa-image")}),e(document).on("click",".richText-toolbar a[data-command]",function(t){var n=e(this);if(n.closest(".richText-toolbar").siblings("#"+q).length>0&&(!n.parent("li").attr("data-disable")||"false"===n.parent("li").attr("data-disable"))){t.preventDefault();var i=e(this).data("command");if("toggleCode"===i)p();else{var l=null;e(this).data("option")&&(l=e(this).data("option")).match(/^h[1-6]$/)&&(i="heading"),a(i,l),"removeFormat"===i&&a("formatBlock","div")}}}),window.getSelection&&document.createRange?(u=function(){var e=document.getElementById(q),t=window.getSelection&&window.getSelection();if(t&&t.rangeCount>0){var a=window.getSelection().getRangeAt(0),n=a.cloneRange();n.selectNodeContents(e),n.setEnd(a.startContainer,a.startOffset);var i=n.toString().length;return{start:i,end:i+a.toString().length}}return g||{start:0,end:0}},h=function(){var e=document.getElementById(q),t=g,a=0,n=document.createRange();n.setStart(e,0),n.collapse(!0);for(var i,l=[e],r=!1,o=!1;!o&&(i=l.pop());)if(3===i.nodeType){var d=a+i.length;!r&&t.start>=a&&t.start<=d&&(n.setStart(i,t.start-a),r=!0),r&&t.end>=a&&t.end<=d&&(n.setEnd(i,t.end-a),o=!0),a=d}else for(var c=i.childNodes.length;c--;)l.push(i.childNodes[c]);var p=window.getSelection();p.removeAllRanges(),p.addRange(n)}):document.selection&&document.body.createTextRange&&(u=function(){var e=document.getElementById(q),t=document.selection.createRange(),a=document.body.createTextRange();a.moveToElementText(e),a.setEndPoint("EndToStart",t);var n=a.text.length;return{start:n,end:n+t.text.length}},h=function(){var e=document.getElementById(q),t=g,a=document.body.createTextRange();a.moveToElementText(e),a.collapse(!0),a.moveEnd("character",t.end),a.moveStart("character",t.start),a.select()}),e(this)}}(jQuery);