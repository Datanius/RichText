!function(e){e.fn.richText=function(t){function n(e,t){void 0===t&&(t=null),d(),"heading"===e&&o()?c("<"+t+">"+o()+"</"+t+">"):document.execCommand(e,!1,t)}function a(){var t=e("#"+K),n=t.html();!0===u.useSingleQuotes&&(n=s(n)),t.siblings(".richText-initial").val(n)}function i(){var t=e("#"+K),n=t.siblings(".richText-initial").val();t.html(n)}function l(e,t){if(9!==t.keyCode)return!1;var n;if(e.getSelection&&(n=e.getSelection()).rangeCount>0){var a=null;if(null!=(a=t.shiftKey?"TD"===n.focusNode.nodeName?null!=n.focusNode.previousSibling?n.focusNode.previousSibling:null!=n.focusNode.parentNode.previousSibling?n.focusNode.parentNode.previousSibling.childNodes[n.focusNode.parentNode.previousSibling.childNodes.length-1]:null:null!=n.focusNode.parentNode.previousSibling?n.focusNode.parentNode.previousSibling:null!=n.focusNode.parentNode.parentNode.previousSibling?n.focusNode.parentNode.parentNode.previousSibling.childNodes[n.focusNode.parentNode.parentNode.previousSibling.childNodes.length-1]:null:"TD"===n.focusNode.nodeName?null!=n.focusNode.nextSibling?n.focusNode.nextSibling:null!=n.focusNode.parentNode.nextSibling?n.focusNode.parentNode.nextSibling.childNodes[0]:null:null!=n.focusNode.parentNode.nextSibling?n.focusNode.parentNode.nextSibling:null!=n.focusNode.parentNode.parentNode.nextSibling?n.focusNode.parentNode.parentNode.nextSibling.childNodes[0]:null))return n.collapse(a,Math.min(a.length,n.focusOffset+1)),null!=a.textContent&&n.selectAllChildren(a),t.preventDefault(),!0}return!1}function o(){return window.getSelection?window.getSelection().toString():!!document.selection.createRange&&document.selection.createRange().text}function r(){x=m()}function d(){x&&g()}function c(e){var t,n;if(window.getSelection){if((t=window.getSelection()).getRangeAt&&t.rangeCount){(n=t.getRangeAt(0)).deleteContents();var a=document.createElement("div");a.innerHTML=e;for(var i,l,o=document.createDocumentFragment();i=a.firstChild;)l=o.appendChild(i);n.insertNode(o),l&&((n=n.cloneRange()).setStartAfter(l),n.collapse(!0),t.removeAllRanges(),t.addRange(n))}}else document.selection&&"Control"!==document.selection.type&&document.selection.createRange().pasteHTML(e)}function s(e){if(!e)return"";var t,n;return!0===u.useSingleQuotes?(t=/\s+(\w+\s*=\s*(["][^"]*["])|(['][^']*[']))+/g,n=e.replace(t,function(e,t,n){return n?e.replace(n,n.replace(/\"/g,"'")):e})):(t=/\s+(\w+\s*=\s*(['][^']*['])|(["][^"]*["]))+/g,n=e.replace(t,function(e,t,n){return n?e.replace(n,n.replace(/'/g,'"')):e})),n}function p(){h.find(".richText-editor").is(":visible")?(h.find(".richText-initial").show(),h.find(".richText-editor").hide(),e(".richText-toolbar").find(".richText-btn").each(function(){e(this).hasClass("fa-code")||e(this).parent("li").attr("data-disable","true")})):(h.find(".richText-initial").hide(),h.find(".richText-editor").show(),e(".richText-toolbar").find("li").removeAttr("data-disable"))}var u=e.extend({bold:!0,italic:!0,underline:!0,leftAlign:!0,centerAlign:!0,rightAlign:!0,ol:!0,ul:!0,heading:!0,fontColor:!0,imageUpload:!0,fileUpload:!0,urls:!0,table:!0,removeStyles:!0,code:!0,colors:[],fileHTML:"",imageHTML:"",useSingleQuotes:!1},t),f=e(this);f.addClass("richText-initial");var h,m,g,x,v=e("<ul />"),T=e("<li />"),b=e("<a />",{class:"richText-btn fa fa-bold","data-command":"bold"}),N=e("<a />",{class:"richText-btn fa fa-italic","data-command":"italic"}),S=e("<a />",{class:"richText-btn fa fa-underline","data-command":"underline"}),w=e("<a />",{class:"richText-btn fa fa-align-left","data-command":"justifyLeft"}),R=e("<a />",{class:"richText-btn fa fa-align-center","data-command":"justifyCenter"}),y=e("<a />",{class:"richText-btn fa fa-align-right","data-command":"justifyRight"}),C=e("<a />",{class:"richText-btn fa fa-list-ol","data-command":"insertOrderedList"}),L=e("<a />",{class:"richText-btn fa fa-list","data-command":"insertUnorderedList"}),k=e("<a />",{class:"richText-btn fa fa-header"}),U=e("<a />",{class:"richText-btn fa fa-paint-brush"}),F=e("<a />",{class:"richText-btn fa fa-image"}),A=e("<a />",{class:"richText-btn fa fa-file-text-o"}),D=e("<a />",{class:"richText-btn fa fa-link"}),B=e("<a />",{class:"richText-btn fa fa-table"}),E=e("<a />",{class:"richText-btn fa fa-recycle","data-command":"removeFormat"}),M=e("<a />",{class:"richText-btn fa fa-code","data-command":"toggleCode"}),H=e("<div />",{class:"richText-dropdown-outer"}),I=e("<span />",{class:"richText-dropdown-close",html:'<span class="fa fa-times"></span>'}),Q=e("<ul />",{class:"richText-dropdown"}),O=e("<div />",{class:"richText-dropdown"}),P=e("<div />",{class:"richText-form"}),W=e("<div />",{class:"richText-form-item"}),_=e("<label />"),j=e("<input />",{type:"text"}),q=(e("<input />",{type:"file"}),e("<select />")),G=e("<button />",{text:"Einf√ºgen",class:"btn"}),K="richText-"+Math.random().toString(36).substring(7),X=Q.clone();X.append(e("<li />",{html:'<a data-command="formatBlock" data-option="h1">Title #1</a>'})),X.append(e("<li />",{html:'<a data-command="formatBlock" data-option="h2">Title #2</a>'})),X.append(e("<li />",{html:'<a data-command="formatBlock" data-option="h3">Title #3</a>'})),X.append(e("<li />",{html:'<a data-command="formatBlock" data-option="h4">Title #4</a>'})),k.append(H.clone().append(X.prepend(I.clone())));var Y=Q.clone();Y.html(function(e){var t=[],n="";t["#FFFFFF"]="White",t["#000000"]="Black",t["#7F6000"]="Brown",t["#938953"]="Beige",t["#1F497D"]="Dark Blue",t.blue="Blue",t["#4F81BD"]="Light blue",t["#953734"]="Dark red",t.red="Red",t["#4F6128"]="Dark green",t.green="Green",t["#3F3151"]="Purple",t["#31859B"]="Dark Turquois",t["#4BACC6"]="Turquois",t["#E36C09"]="Dark orange",t["#F79646"]="Orange",t["#FFFF00"]="Yellow",u.colors&&u.colors.length>0&&(t=u.colors);for(var a in t)n+='<li class="inline"><a data-command="'+e+'" data-option="'+a+'" style="text-align:left;" title="'+t[a]+'"><span class="box-color" style="background-color:'+a+'"></span></a></li>';return n}("forecolor")),U.append(H.clone().append(Y.prepend(I.clone())));var $=O.clone(),z=P.clone().attr("id","richText-URL").attr("data-editor",K);z.append(W.clone().append(_.clone().text("URL").attr("for","url")).append(j.clone().attr("id","url"))),z.append(W.clone().append(_.clone().text("Text").attr("for","urlText")).append(j.clone().attr("id","urlText"))),z.append(W.clone().append(_.clone().text("Open in").attr("for","openIn")).append(q.clone().attr("id","openIn").append(e("<option />",{value:"_self",text:"Same tab"})).append(e("<option />",{value:"_blank",text:"New tab"})))),z.append(W.clone().append(G.clone())),$.append(z),D.append(H.clone().append($.prepend(I.clone())));var J=O.clone(),V=P.clone().attr("id","richText-Image").attr("data-editor",K);u.imageHTML&&(e(u.imageHTML).find("#imageURL").length>0||"imageURL"===e(u.imageHTML).attr("id"))?V.html(u.imageHTML):(V.append(W.clone().append(_.clone().text("Image URL").attr("for","imageURL")).append(j.clone().attr("id","imageURL"))),V.append(W.clone().append(_.clone().text("Align").attr("for","align")).append(q.clone().attr("id","align").append(e("<option />",{value:"left",text:"Left"})).append(e("<option />",{value:"center",text:"Center"})).append(e("<option />",{value:"right",text:"Right"}))))),V.append(W.clone().append(G.clone())),J.append(V),F.append(H.clone().append(J.prepend(I.clone())));var Z=O.clone(),ee=P.clone().attr("id","richText-File").attr("data-editor",K);u.fileHTML&&(e(u.fileHTML).find("#fileURL").length>0||"fileURL"===e(u.fileHTML).attr("id"))?ee.html(u.fileHTML):(ee.append(W.clone().append(_.clone().text("File URL").attr("for","fileURL")).append(j.clone().attr("id","fileURL"))),ee.append(W.clone().append(_.clone().text("Link text").attr("for","fileText")).append(j.clone().attr("id","fileText")))),ee.append(W.clone().append(G.clone())),Z.append(ee),A.append(H.clone().append(Z.prepend(I.clone())));var te=O.clone(),ne=P.clone().attr("id","richText-Table").attr("data-editor",K);ne.append(W.clone().append(_.clone().text("Rows").attr("for","tableRows")).append(j.clone().attr("id","tableRows").attr("type","number"))),ne.append(W.clone().append(_.clone().text("Columns").attr("for","tableColumns")).append(j.clone().attr("id","tableColumns").attr("type","number"))),ne.append(W.clone().append(G.clone())),te.append(ne),B.append(H.clone().append(te.prepend(I.clone())));return function(){var t,n,a="";"TEXTAREA"===f.prop("tagName")||(f.val()?(t=f.val(),n=f.prop("attributes"),e.each(n,function(){this.name&&(a+=" "+this.name+'="'+this.value+'"')}),f.replaceWith(e("<textarea"+a+' data-richtext="init">'+t+"</textarea>")),(f=e('[data-richtext="init"]')).removeAttr("data-richtext")):f.html()?(t=f.html(),n=f.prop("attributes"),e.each(n,function(){this.name&&(a+=" "+this.name+'="'+this.value+'"')}),f.replaceWith(e("<textarea"+a+' data-richtext="init">'+t+"</textarea>")),(f=e('[data-richtext="init"]')).removeAttr("data-richtext")):(n=f.prop("attributes"),e.each(n,function(){this.name&&(a+=" "+this.name+'="'+this.value+'"')}),f.replaceWith(e("<textarea"+a+' data-richtext="init"></textarea>')),(f=e('[data-richtext="init"]')).removeAttr("data-richtext"))),h=e("<div />",{class:"richText"});var i=e("<div />",{class:"richText-toolbar"}),l=e("<div />",{class:"richText-editor",id:K,contenteditable:!0});i.append(v),!0===u.bold&&v.append(T.clone().append(b)),!0===u.italic&&v.append(T.clone().append(N)),!0===u.underline&&v.append(T.clone().append(S)),!0===u.leftAlign&&v.append(T.clone().append(w)),!0===u.centerAlign&&v.append(T.clone().append(R)),!0===u.rightAlign&&v.append(T.clone().append(y)),!0===u.ol&&v.append(T.clone().append(C)),!0===u.ul&&v.append(T.clone().append(L)),!0===u.heading&&v.append(T.clone().append(k)),!0===u.fontColor&&v.append(T.clone().append(U)),!0===u.imageUpload&&v.append(T.clone().append(F)),!0===u.fileUpload&&v.append(T.clone().append(A)),!0===u.urls&&v.append(T.clone().append(D)),!0===u.table&&v.append(T.clone().append(B)),!0===u.removeStyles&&v.append(T.clone().append(E)),!0===u.code&&v.append(T.clone().append(M)),l.html(f.val()),h.append(i),h.append(l),h.append(f.clone().hide()),f.replaceWith(h)}(),e(document).on("keyup keydown blur paste copy cut",".richText-editor",function(e){if((9===e.keyCode||"9"===e.keyCode)&&"keydown"===e.type)return e.preventDefault(),l(window,e),!1;a(),r()}),e(document).on("keyup keydown blur paste copy cut",".richText-initial",function(){i(),r()}),e(document).on("dblclick mouseup",".richText-editor",function(){r()}),e(document).on("click","#richText-URL button.btn",function(t){t.preventDefault();var n=e(this).parent(".richText-form-item").parent(".richText-form");if(n.attr("data-editor")===K){var a=n.find("input#url").val(),i=n.find("input#urlText").val(),l=n.find("#openIn").val();if(l||(l="_self"),i||(i=a),a){var o="";o=!0===u.useSingleQuotes?"<a href='"+a+"' target='"+l+"'>"+i+"</a>":'<a href="'+a+'" target="'+l+'">'+i+"</a>",g(),c(o),n.find("input#url").val(""),n.find("input#urlText").val(""),e(".richText-toolbar li.is-selected").removeClass("is-selected")}else n.prepend(e("<div />",{style:"color:red;display:none;",class:"form-item is-error",text:"Please enter an URL"})),n.children(".form-item.is-error").slideDown(),setTimeout(function(){n.children(".form-item.is-error").slideUp(function(){e(this).remove()})},5e3)}}),e(document).on("click","#richText-Image button.btn",function(t){t.preventDefault();var n=e(this).parent(".richText-form-item").parent(".richText-form");if(n.attr("data-editor")===K){var a=n.find("#imageURL").val(),i=n.find("select#align").val();if(i||(i="center"),a){var l="";!0===u.useSingleQuotes?(console.log("image"),l="center"===i?"<div style='text-align:center;'><img src='"+a+"'></div>":"<img src='"+a+"' align='"+i+"'>"):l="center"===i?'<div style="text-align:center;"><img src="'+a+'"></div>':'<img src="'+a+'" align="'+i+'">',g(),c(l),n.find("input#imageURL").val(""),e(".richText-toolbar li.is-selected").removeClass("is-selected")}else n.prepend(e("<div />",{style:"color:red;display:none;",class:"form-item is-error",text:"Please select an image."})),n.children(".form-item.is-error").slideDown(),setTimeout(function(){n.children(".form-item.is-error").slideUp(function(){e(this).remove()})},5e3)}}),e(document).on("click","#richText-File button.btn",function(t){t.preventDefault();var n=e(this).parent(".richText-form-item").parent(".richText-form");if(n.attr("data-editor")===K){var a=n.find("#fileURL").val(),i=n.find("#fileText").val();if(i||(i=a),a){var l="";l=!0===u.useSingleQuotes?"<a href='"+a+"' target='_blank'>"+i+"</a>":'<a href="'+a+'" target="_blank">'+i+"</a>",g(),c(l),n.find("input#fileURL").val(""),n.find("input#fileText").val(""),e(".richText-toolbar li.is-selected").removeClass("is-selected")}else n.prepend(e("<div />",{style:"color:red;display:none;",class:"form-item is-error",text:"Please select a file."})),n.children(".form-item.is-error").slideDown(),setTimeout(function(){n.children(".form-item.is-error").slideUp(function(){e(this).remove()})},5e3)}}),e(document).on("click","#richText-Table button.btn",function(t){t.preventDefault();var n=e(this).parent(".richText-form-item").parent(".richText-form");if(n.attr("data-editor")===K){var a=n.find("input#tableRows").val(),i=n.find("input#tableColumns").val();(!a||a<=0)&&(a=2),(!i||i<=0)&&(i=2);var l="";l=!0===u.useSingleQuotes?"<table class='table-1'><tbody>":'<table class="table-1"><tbody>';for(var o=1;o<=a;o++){l+="<tr>";for(var r=1;r<=i;r++)l+="<td> </td>";l+="</tr>"}l+="</tbod></table>",g(),c(l),n.find("input#tableColumns").val(""),n.find("input#tableRows").val(""),e(".richText-toolbar li.is-selected").removeClass("is-selected")}}),e(document).on("click",function(t){var n=e(t.target);if(0===n.parents(".richText-toolbar").length);else if(n.hasClass("richText-dropdown-outer"))n.parent("a").parent("li").removeClass("is-selected");else if(n.find(".richText").length>0)e(".richText-toolbar li").removeClass("is-selected");else if(n.parent().hasClass("richText-dropdown-close"))e(".richText-toolbar li").removeClass("is-selected");else if(n.hasClass("richText-btn")&&e(t.target).children(".richText-dropdown-outer").length>0)if(n.parent("li").addClass("is-selected"),n.hasClass("fa-link")){g();var a=o();n.find("input#urlText").val(""),n.find("input#url").val(""),a&&n.find("input#urlText").val(a)}else n.hasClass("fa-image")}),e(document).on("click",".richText-toolbar a[data-command]",function(t){var a=e(this);if(a.closest(".richText-toolbar").siblings("#"+K).length>0&&(!a.parent("li").attr("data-disable")||"false"===a.parent("li").attr("data-disable"))){t.preventDefault();var i=e(this).data("command");if("toggleCode"===i)p();else{var l=null;e(this).data("option")&&(l=e(this).data("option")).match(/^h[1-6]$/)&&(i="heading"),n(i,l),"removeFormat"===i&&n("formatBlock","div")}}}),window.getSelection&&document.createRange?(m=function(){var e=document.getElementById(K),t=window.getSelection&&window.getSelection();if(t&&t.rangeCount>0){var n=window.getSelection().getRangeAt(0),a=n.cloneRange();a.selectNodeContents(e),a.setEnd(n.startContainer,n.startOffset);var i=a.toString().length;return{start:i,end:i+n.toString().length}}return x||{start:0,end:0}},g=function(){var e=document.getElementById(K),t=x,n=0,a=document.createRange();a.setStart(e,0),a.collapse(!0);for(var i,l=[e],o=!1,r=!1;!r&&(i=l.pop());)if(3===i.nodeType){var d=n+i.length;!o&&t.start>=n&&t.start<=d&&(a.setStart(i,t.start-n),o=!0),o&&t.end>=n&&t.end<=d&&(a.setEnd(i,t.end-n),r=!0),n=d}else for(var c=i.childNodes.length;c--;)l.push(i.childNodes[c]);var s=window.getSelection();s.removeAllRanges(),s.addRange(a)}):document.selection&&document.body.createTextRange&&(m=function(){var e=document.getElementById(K),t=document.selection.createRange(),n=document.body.createTextRange();n.moveToElementText(e),n.setEndPoint("EndToStart",t);var a=n.text.length;return{start:a,end:a+t.text.length}},g=function(){var e=document.getElementById(K),t=x,n=document.body.createTextRange();n.moveToElementText(e),n.collapse(!0),n.moveEnd("character",t.end),n.moveStart("character",t.start),n.select()}),e(this)}}(jQuery);